# telemetry install

With this you will deploy a comprehensive Grafana observability stack for your Kubernetes cluster. In other words, the Grafana Kubernetes Monitoring Helm chart, which:
	•	Collects and forwards telemetry: It configures destinations to push metrics (via Prometheus remote write), logs (via Loki), and traces (via Tempo/OTLP) to Grafana Cloud.
	•	Sets up application instrumentation endpoints: It deploys receivers (OTLP/gRPC, OTLP/HTTP, and Zipkin) via Grafana Alloy, allowing your applications to send custom telemetry data.
	•	Enables cluster-level insights: It includes features for cluster metrics (with integrations like OpenCost and Kepler), cluster events, and pod logs.
	•	Integrates Grafana Alloy components: This provides additional observability capabilities through alloy-metrics, alloy-singleton, alloy-logs, and alloy-receiver.

In short, you now have a full-stack observability solution in your cluster that not only collects and forwards data to Grafana Cloud but also provides endpoints for your applications to send telemetry directly.

logs from your pods will show up in: 

<!-- token generated by grafana : -->
`glc_eyJvIjoiMTM1NTQ0NyIsIm4iOiJzdGFjay0xMTc3ODA5LWludGVncmF0aW9uLWdyYWZhbmFjbG91ZC10b2tlbi1ncmFmYW5hY2xvdWQtdG9rZW4iLCJrIjoiNDZ1YzNlWTlGRzNycDg3M215ZDIxUm5DIiwibSI6eyJyIjoicHJvZC11cy13ZXN0LTAifX0=`

helm install 

```
helm repo add grafana https://grafana.github.io/helm-charts &&
  helm repo update &&
  helm upgrade --install --version ^2 --atomic --timeout 300s grafana-k8s-monitoring grafana/k8s-monitoring \
    --namespace "telemetry" --create-namespace --values - <<EOF
cluster:
  name: non-prod-cluster1
destinations:
  - name: geoffit-prom
    type: prometheus
    url: https://prometheus-prod-36-prod-us-west-0.grafana.net/api/prom/push
    auth:
      type: basic
      username: "2279861"
      password: glc_eyJvIjoiMTM1NTQ0NyIsIm4iOiJzdGFjay0xMTc3ODA5LWludGVncmF0aW9uLWdyYWZhbmFjbG91ZC10b2tlbi1ncmFmYW5hY2xvdWQtdG9rZW4iLCJrIjoiNDZ1YzNlWTlGRzNycDg3M215ZDIxUm5DIiwibSI6eyJyIjoicHJvZC11cy13ZXN0LTAifX0=
  - name: geoffit-logs
    type: loki
    url: https://logs-prod-021.grafana.net/loki/api/v1/push
    auth:
      type: basic
      username: "1135608"
      password: glc_eyJvIjoiMTM1NTQ0NyIsIm4iOiJzdGFjay0xMTc3ODA5LWludGVncmF0aW9uLWdyYWZhbmFjbG91ZC10b2tlbi1ncmFmYW5hY2xvdWQtdG9rZW4iLCJrIjoiNDZ1YzNlWTlGRzNycDg3M215ZDIxUm5DIiwibSI6eyJyIjoicHJvZC11cy13ZXN0LTAifX0=
  - name: geoffit-traces
    type: otlp
    url: https://tempo-prod-15-prod-us-west-0.grafana.net:443
    protocol: grpc
    auth:
      type: basic
      username: "1129923"
      password: glc_eyJvIjoiMTM1NTQ0NyIsIm4iOiJzdGFjay0xMTc3ODA5LWludGVncmF0aW9uLWdyYWZhbmFjbG91ZC10b2tlbi1ncmFmYW5hY2xvdWQtdG9rZW4iLCJrIjoiNDZ1YzNlWTlGRzNycDg3M215ZDIxUm5DIiwibSI6eyJyIjoicHJvZC11cy13ZXN0LTAifX0=
    metrics:
      enabled: false
    logs:
      enabled: false
    traces:
      enabled: true
clusterMetrics:
  enabled: true
  opencost:
    enabled: true
    metricsSource: geoffit-prom
    opencost:
      exporter:
        defaultClusterId: non-prod-cluster1
      prometheus:
        existingSecretName: geoffit-prom-grafana-k8s-monitoring
        external:
          url: https://prometheus-prod-36-prod-us-west-0.grafana.net/api/prom
  kepler:
    enabled: true
clusterEvents:
  enabled: true
podLogs:
  enabled: true
applicationObservability:
  enabled: true
  receivers:
    otlp:
      grpc:
        enabled: true
        port: 4317
      http:
        enabled: true
        port: 4318
    zipkin:
      enabled: true
      port: 9411
integrations:
  alloy:
    instances:
      - name: alloy
        labelSelectors:
          app.kubernetes.io/name:
            - alloy-metrics
            - alloy-singleton
            - alloy-logs
            - alloy-receiver
alloy-metrics:
  enabled: true
alloy-singleton:
  enabled: true
alloy-logs:
  enabled: true
alloy-receiver:
  enabled: true
  alloy:
    extraPorts:
      - name: otlp-grpc
        port: 4317
        targetPort: 4317
        protocol: TCP
      - name: otlp-http
        port: 4318
        targetPort: 4318
        protocol: TCP
      - name: zipkin
        port: 9411
        targetPort: 9411
        protocol: TCP
EOF
```

output after applying the above

```
"grafana" already exists with the same configuration, skipping
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the "aws-ebs-csi-driver" chart repository
...Successfully got an update from the "traefik" chart repository
...Successfully got an update from the "grafana" chart repository
...Successfully got an update from the "bitnami-chart" chart repository
...Successfully got an update from the "bitnami" chart repository
Update Complete. ⎈Happy Helming!⎈
Release "grafana-k8s-monitoring" does not exist. Installing it now.
NAME: grafana-k8s-monitoring
LAST DEPLOYED: Wed Feb 19 14:07:38 2025
NAMESPACE: telemetry
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
Grafana k8s-monitoring Helm chart deployed!

This chart will install the following components:
* kube-state-metrics (Deployment)
* Node Exporter (DaemonSet)
* Windows Exporter (DaemonSet)
* Kepler (DaemonSet)
* Grafana Alloy "alloy-metrics" (statefulset, 1 replica)
* Grafana Alloy "alloy-singleton" (deployment, 1 replica)
* Grafana Alloy "alloy-logs" (daemonset)
* Grafana Alloy "alloy-receiver" (daemonset)

It will:
* Gather application data via OTLP gRPC, OTLP HTTP, and Zipkin receivers and send data to geoffit-prom, geoffit-logs, and geoffit-traces.
* Scrape Kubernetes Cluster metrics and send data to geoffit-prom.
* Gather Kubernetes Cluster events and send data to geoffit-logs.
* Gather logs from Kubernetes Pods and send data to geoffit-logs.
* Gather data from the Alloy integration. and send data to geoffit-prom.
  
Configure your applications to send telemetry data to:
* http://grafana-k8s-monitoring-alloy-receiver.telemetry.svc.cluster.local:4317 (OTLP gRPC)
* http://grafana-k8s-monitoring-alloy-receiver.telemetry.svc.cluster.local:4318 (OTLP HTTP)
* http://grafana-k8s-monitoring-alloy-receiver.telemetry.svc.cluster.local:9411 (Zipkin)
```
